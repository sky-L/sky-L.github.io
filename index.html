<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/ven/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/ven/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="行走于浩瀚">
<meta property="og:type" content="website">
<meta property="og:title" content="skylee">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="skylee">
<meta property="og:description" content="行走于浩瀚">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="skylee">
<meta name="twitter:description" content="行走于浩瀚">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> skylee </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">skylee</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">抽到断水水更流</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/06/21/gitlab-ci/" itemprop="url">
                  GitLab-CI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-06-21T09:56:06+08:00" content="2018-06-21">
              2018-06-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/运维/" itemprop="url" rel="index">
                    <span itemprop="name">运维</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="引子">引子</h2><blockquote>
<p>最近入职了新公司一段时间了，做了一个项目。 用到很多之前了解过，但一直没机会实战的技术。接下来用几篇文章来总结一下使用到的技术和遇到的一些问题。</p>
</blockquote>
<p>目前会包括 2 个部分</p>
<ul>
<li>gitLab-ci 自动构建</li>
<li>k8s 自动发布集群</li>
</ul>
<h3 id="整体的发布流程">整体的发布流程</h3><p><img src="http://orsm22n69.bkt.clouddn.com/cicd.png" alt=""></p>
<p>接下来就先从 gitlab-ci 开始</p>
<h2 id="GitLab-CI">GitLab-CI</h2><h3 id="基本条件">基本条件</h3><ul>
<li>拥有 gitLab 官方账号，或者有私有的 gitLab 仓库。</li>
<li>会使用 GIT</li>
<li>如果以上都不会，那面壁去吧。</li>
<li>最后先熟悉一下 <a href="https://docs.gitlab.com/ee/ci/" target="_blank" rel="external">官方文档</a>，虽然不是必须，但是有助于接下来的操作。</li>
</ul>
<h3 id="构建流程">构建流程</h3><p><img src="https://docs.gitlab.com/ee/ci/img/cicd_pipeline_infograph.png" alt=""></p>
<h3 id="步骤">步骤</h3><ul>
<li>首先开开心心的去 gitLab 创建一个新项目。以我的为例 <code>http://gitlab.**.com/skylee/my_test_ci</code></li>
<li>在服务器上安装  <a href="https://docs.gitlab.com/runner/install/linux-manually.html" target="_blank" rel="external"><code>gitLab-runner</code></a> 服务</li>
<li>注册  <a href="https://docs.gitlab.com/runner/register/index.html" target="_blank" rel="external"><code>runner</code></a></li>
<li>在项目根目录下新增文件  <code>.gitlab-ci.yml</code>  </li>
</ul>
<h3 id="Usage">Usage</h3><h4 id="把代码打包成镜像并推送到远程仓库">把代码打包成镜像并推送到远程仓库</h4><p>项目代码 只有一个 <code>index.php</code> 文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="tag">my_test_ci</span> <span class="tag">git</span><span class="pseudo">:(master)</span> <span class="tag">tree</span></span><br><span class="line">.</span><br><span class="line">├── <span class="tag">Dockerfile</span></span><br><span class="line">└── <span class="tag">index</span><span class="class">.php</span></span><br></pre></td></tr></table></figure>
<p>其中 <code>Dockerfile</code> 文件为构建镜像，主要作用就是把 <code>index.php</code> 打包进镜像中。<code>Dockerfile</code> 的内容</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">FROM</span> php:<span class="number">7.2</span>-fpm</span><br><span class="line"><span class="built_in">VOLUME</span> <span class="bash">/data</span><br><span class="line"></span><span class="built_in">ADD</span> <span class="bash">. /data/www</span><br><span class="line"></span><span class="built_in">WORKDIR</span> <span class="bash">/data/www</span><br><span class="line"></span><span class="built_in">EXPOSE</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<h5 id="配置_-gitlab-ci-yml">配置  <a href="https://docs.gitlab.com/ee/ci/yaml/README.html" target="_blank" rel="external"><code>.gitlab-ci.yml</code> </a></h5><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">image</span>: <span class="string">docker.io/skylee:docker</span></span><br><span class="line"></span><br><span class="line"><span class="haml">stages:</span><br><span class="line">  -<span class="ruby"> package</span><br><span class="line"></span></span><br><span class="line">docker-build:</span><br><span class="line">  stage: package</span><br><span class="line">  before_script:</span><br><span class="line">    -<span class="ruby"> source /etc/profile.d/docker</span><br><span class="line"></span>  script:</span><br><span class="line">    -<span class="ruby"> echo <span class="string">'Building...'</span></span><br><span class="line"></span>    -<span class="ruby"> docker login -u <span class="variable">$REPOSITORY_USER</span> -p <span class="variable">$REPOSITORY_PASSWORD</span> hub.docker.com</span><br><span class="line"></span>    -<span class="ruby"> docker build -t skylee/<span class="symbol">phptest:</span>latest .</span><br><span class="line"></span>    -<span class="ruby"> docker push skylee/<span class="symbol">phptest:</span>latest</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>docker.io/skylee:docker 是基于 docker:git 镜像，添加了一些环境变量。</p>
</blockquote>
<h5 id="git_push_之后会触发构建过程">git push 之后会触发构建过程</h5><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Running <span class="keyword">with</span> gitlab<span class="attribute">-runner</span> <span class="number">10.8</span><span class="number">.0</span> (<span class="number">079</span>aad9e)</span><br><span class="line">  <span class="keyword">on</span> <span class="number">192</span>-<span class="number">168</span>-<span class="number">53</span>-<span class="number">35</span> <span class="number">337</span>b5bc7</span><br><span class="line">Using Docker execut<span class="subst">or</span> <span class="keyword">with</span> image docker<span class="built_in">.</span>io/skylee:docker <span class="attribute">...</span></span><br><span class="line">Pulling docker image docker<span class="built_in">.</span>io/skylee:docker <span class="attribute">...</span></span><br><span class="line">Using docker image sha256:<span class="number">58</span>cf969aeca7f67649540fb60b1853a153dc3660bbb2e0b7ba33cdb752723cc7 f<span class="subst">or</span> docker<span class="built_in">.</span>io/skylee:docker <span class="attribute">...</span></span><br><span class="line">Running <span class="keyword">on</span> runner-<span class="number">337</span>b5bc7<span class="attribute">-project</span>-<span class="number">34</span><span class="attribute">-concurrent</span>-<span class="number">0</span> via <span class="number">192</span>-<span class="number">168</span>-<span class="number">53</span>-<span class="number">35.</span><span class="built_in">..</span><br><span class="line"></span>Cloning repository<span class="attribute">...</span></span><br><span class="line">Cloning <span class="keyword">into</span> <span class="string">'/builds/likai15/my_test_ci'</span><span class="attribute">...</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">...</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <code>image: docker.io/skylee:docker</code> 启动一个容器。之后所有的命令都是在容器内操作的。</li>
<li>启动 <code>docker:dind</code> 服务。也就是 <code>docker</code> 的进程。</li>
<li><code>gitlab-runner</code> 克隆代码到容器目录  <code>/builds/likai15/my_test_ci</code>。 由于没有指定挂载目录，可以在宿主机的默认挂载目录看到 <code>/var/lib/docker/xxxx/_data/my_test_ci</code></li>
<li>开始执行 <code>docker-build</code> 阶段的 job。</li>
</ul>
<h3 id="FAQ">FAQ</h3><ul>
<li><p>mount: permission denied (are you root?) 答： <a href="https://gitlab.com/gitlab-org/gitlab-runner/issues/1544" target="_blank" rel="external">这里</a></p>
</li>
<li><p>docker:dind 是啥东西？ 答 ：<a href="https://hub.docker.com/_/docker/" target="_blank" rel="external">这里</a></p>
</li>
<li>构建过程耗时过长 ？  答：一般我们都会自己搭建一个私有的内网仓库。</li>
</ul>
<h2 id="搭建私有_docker_仓库">搭建私有 docker 仓库</h2><ul>
<li><a href="https://blog.csdn.net/u010397369/article/details/42422243" target="_blank" rel="external">参考</a></li>
</ul>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">5000</span>:<span class="number">5000</span> -v /<span class="keyword">registry</span>:/tmp/<span class="keyword">registry</span> <span class="keyword">registry</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>只是简单搭建了一个用 docker.images 的私有仓库。也可以使用 [Harbor] 。(<a href="https://github.com/vmware/harbor/" target="_blank" rel="external">https://github.com/vmware/harbor/</a>)<br>参考 <a href="https://www.souyunku.com/2018/01/06/Docker-harbor-registry/" target="_blank" rel="external">搭建 Harbor</a></p>
</blockquote>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/03/01/sqoop/" itemprop="url">
                  Sqoop实战
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-03-01T18:56:06+08:00" content="2018-03-01">
              2018-03-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Sqoop">Sqoop</h2><h4 id="安装">安装</h4><ul>
<li>下载  sqoop-1.4.6.bin__hadoop-2.0.4-alpha.tar.gz <a href="http://sqoop.apache.org/" target="_blank" rel="external">网址</a></li>
<li>配置环境变量 </li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> HADOOP_COMMON_HOME=/home/hadoop/opt/hadoop-<span class="number">2.6</span><span class="number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> HADOOP_MAPRED_HOME=/home/hadoop/opt/hadoop-<span class="number">2.6</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<ul>
<li>下载 mysql  jra包 <a href="https://dev.mysql.com/downloads/connector/j/" target="_blank" rel="external">地址</a> 把 mysql-connector-java-5.1.45-bin.jar 复制到 <code>SQOOP_HOME/lib</code></li>
</ul>
<h4 id="一些例子：">一些例子：</h4><h5 id="把_mysql_数据导入到_hdfs">把 mysql 数据导入到 hdfs</h5><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 链接数据库  这个只做提示作用,相当于是个变量</span><br><span class="line"><span class="label">$c</span> = <span class="string">" --connect jdbc:mysql://192.168.0.89:3306/tob --username web --password passwd "</span> </span><br><span class="line"></span><br><span class="line"># 查看数据库列表</span><br><span class="line">sqoop <span class="keyword">list</span>-databases <span class="label">$c</span></span><br><span class="line"></span><br><span class="line">-- 把表 tob_dealer 数据导出到 /tmp 目录， 为 hadoop 文件系统目录</span><br><span class="line">bin/sqoop import <span class="label">$c</span> --<span class="keyword">table</span> tob_dealer --target-<span class="keyword">dir</span> /tmp</span><br><span class="line"></span><br><span class="line">-- 把 tob_dealer 表中的 id，link_phone 字段导入到 hdfs 的 /tmp 目录下</span><br><span class="line">bin/sqoop import  <span class="label">$c</span> --<span class="keyword">table</span> tob_dealer  --columns <span class="string">"id,link_phone"</span>  -<span class="keyword">m</span> 1 --target-<span class="keyword">dir</span> /tmp</span><br></pre></td></tr></table></figure>
<h5 id="把_mysql_数据导入到_Hive_数据仓库表">把 mysql 数据导入到 Hive 数据仓库表</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// -m <span class="number">1</span> 表示 <span class="keyword">map</span>/reduce 作业的个数</span><br><span class="line">//不指定表名称 会自动创建一张同名表（tob_dealer）来保存数据</span><br><span class="line">bin/sqoop <span class="keyword">import</span> --hive-import <span class="variable">$c</span> --table tob_dealer -m <span class="number">1</span></span><br><span class="line"></span><br><span class="line">//指定表名称 hive_tob_dealer。 如果不存在，hive 会自动创建</span><br><span class="line">bin/sqoop <span class="keyword">import</span> --hive-import  <span class="variable">$c</span> --table tob_dealer -m <span class="number">1</span> --hive-table hive_tob_dealer</span><br><span class="line"></span><br><span class="line">//指定 Where 条件。 只导id=<span class="number">1</span>的得数据</span><br><span class="line">bin/sqoop <span class="keyword">import</span> --hive-import  <span class="variable">$c</span> --table tob_dealer -m <span class="number">1</span> --hive-table hive_tob_dealer --<span class="keyword">where</span> <span class="string">'id=1'</span></span><br><span class="line"></span><br><span class="line">//指定 Select  条件。 只导id=<span class="number">1</span>的得数据， 不需要指定 table。必须指定 and <span class="variable">$CONDITIONS</span></span><br><span class="line">bin/sqoop <span class="keyword">import</span> --hive-import  <span class="variable">$c</span>  -m <span class="number">1</span>  --query <span class="string">'select * from tob_dealer where id &gt; 10 and $CONDITIONS'</span>  --target-dir <span class="string">"/tmp/select"</span> --hive-table hive_tob_dealer</span><br></pre></td></tr></table></figure>
<h5 id="hive_导出到_Mysql">hive 导出到 Mysql</h5><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 把 /tmp 目录下的数据导出到 mysql 的表 tob_dealer 中</span><br><span class="line">-- 需要先在 mysql 创建对应的表</span><br><span class="line"> bin/sqoop export <span class="variable">$c</span> --table tob_dealer --export-dir <span class="string">"/tmp"</span></span><br></pre></td></tr></table></figure>
<h4 id="sqoop_遇到的问题">sqoop 遇到的问题</h4><ul>
<li>Error: Could not find or load main class org.apache.sqoop.Sqoop 这是因为找不到sqoop-1.4.5.jar文件导致的。</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">修改 <span class="variable">$SQOOP</span>_HOME/bin/sqoop 脚本最后一行： </span><br><span class="line">exec $&#123;HADOOP_COMMON_HOME&#125;/bin/hadoop org.apache.sqoop.Sqoop <span class="string">"$@"</span> </span><br><span class="line"> 改为</span><br><span class="line">exec $&#123;HADOOP_COMMON_HOME&#125;/bin/hadoopjar <span class="variable">$SQOOP</span>_HOME sqoop-<span class="number">1.4</span>.<span class="number">5</span>.jar org.apache.sqoop.Sqoop <span class="string">"$@"</span> </span><br><span class="line">即：显示指定sqoop-<span class="number">1.4</span>.<span class="number">5</span>.jar文件的所在位置。</span><br></pre></td></tr></table></figure>
<ul>
<li>导数据的时候报错： <code>Could not load org.apache.hadoop.hive.conf.HiveConf. Make sure HIVE_CONF_DIR is set correctly.</code></li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bashrc</span><br><span class="line">export HADOOP_CLASSPATH=<span class="variable">$HADOOP</span>_CLASSPATH:/hive/lib/*</span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
<h4 id="参考列表">参考列表</h4><ul>
<li><a href="https://www.imooc.com/learn/399" target="_blank" rel="external">imooc 课程</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/28/Hive/" itemprop="url">
                  Hive的安装和一些例子
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-02-28T18:56:06+08:00" content="2018-02-28">
              2018-02-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Hive">Hive</h2><p>hive 的表就是 hdfs 的目录，数据就是 hdfs 的文件</p>
<p>嵌入模式：hive ＋ derby，demo</p>
<p>每次执行 hive 命令，都会在当前目录中生成数据 derby 文件</p>
<p>在 console 管理界面执行命令 dfs ls</p>
<p>desc tableName</p>
<p>! 系统命令</p>
<p>Hive -S 静默模式</p>
<p><code>create table (id INT, name STRING)</code></p>
<p> <a href="http://blog.csdn.net/snow327646777/article/details/78230116" target="_blank" rel="external">安装客户端工具</a></p>
<p>  <a href="http://nunknown.com/study/282/" target="_blank" rel="external">Hadoop+Hive环境搭建</a></p>
<h4 id="远程管理">远程管理</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">启动web管理服务 hive --service hwi</span><br><span class="line">编译war包：src/hwi jar cvfM0 hive-hwi-<span class="number">0.13</span>.<span class="number">0</span>.war -<span class="constant">C</span> web/ .</span><br><span class="line">拷贝到hive的<span class="class"><span class="keyword">lib</span>目录下</span></span><br><span class="line">修改hive-site.xml</span><br><span class="line">cp jdk/<span class="class"><span class="keyword">lib</span>/<span class="title">tools</span>.<span class="title">jar</span> <span class="title">hive</span>/<span class="title">lib</span>/</span></span><br><span class="line"></span><br><span class="line">hive --service hiveserver &amp;</span><br></pre></td></tr></table></figure>
<h4 id="数据类型的一些例子">数据类型的一些例子</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> // 学生成绩</span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s (<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">String</span>, grade <span class="built_in">array</span>&lt;<span class="built_in">float</span>&gt;);</span> <span class="comment">--  &#123;1, tom [90, 80.00]&#125;</span></span><br><span class="line"> </span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s2 (<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">String</span>, grade <span class="keyword">map</span>&lt;<span class="keyword">string</span>, <span class="built_in">float</span>&gt;);</span> <span class="comment">--  &#123;1, tom &lt;"语文", 80.00&gt;&#125;</span></span><br><span class="line">    </span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s3 (<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">String</span>, grade <span class="built_in">array</span>&lt;<span class="keyword">map</span>&lt;<span class="keyword">string</span>, <span class="built_in">float</span>&gt;&gt;);</span> <span class="comment">--  &#123;1, tom [&lt;"语文", 80.00&gt;, &lt;"英语", 90.00&gt;]&#125; </span></span><br><span class="line">    </span><br><span class="line">  //结构数据类型</span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s4 (<span class="keyword">id</span> <span class="built_in">int</span>, info <span class="keyword">struct</span>&lt;<span class="keyword">name</span>:<span class="keyword">string</span>, age:<span class="built_in">int</span>&gt;);</span> <span class="comment">-- &#123;1， &#123;"tom", "19"&#125;&#125;</span></span><br><span class="line"> </span><br><span class="line"> // 创建表并指定存储位置，不指定的情况下会默认在 /usr/hive/warehouse</span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s5(<span class="keyword">id</span> <span class="built_in">int</span>) location <span class="string">'/pwd/s5'</span>;</span> </span><br><span class="line"> </span><br><span class="line"> // 指定列的分割符号为 逗号  </span><br><span class="line"> <span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> s6 (<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">String</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span></span><br><span class="line"> </span><br><span class="line"> //创建表并从 s5导入数据，以逗号为列的分隔符</span><br><span class="line"> crate table t7 row format delimited fields terminated by ',' as <span class="operator"><span class="keyword">select</span> * <span class="keyword">form</span> s5;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">select</span> <span class="keyword">unix_timestamp</span>();</span></span><br><span class="line"></span><br><span class="line">date 数据类型只有日期，没有具体到几点的时间</span><br></pre></td></tr></table></figure>
<h4 id="分区表">分区表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//基于 gender 的分区表</span><br><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> partition_table(<span class="keyword">id</span> <span class="built_in">int</span>, <span class="keyword">name</span> <span class="keyword">String</span>) partitioned <span class="keyword">by</span> (gender <span class="keyword">String</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> partition_table <span class="keyword">partition</span>(gender=<span class="string">'M'</span>) slect <span class="keyword">id</span>, <span class="keyword">name</span> <span class="keyword">from</span> sample_data <span class="keyword">where</span> gender = <span class="string">'M'</span>;</span></span><br></pre></td></tr></table></figure>
<h4 id="外部表">外部表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> external_student (<span class="keyword">sid</span> <span class="built_in">int</span>, sname <span class="keyword">string</span>, age <span class="built_in">int</span>) <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span> location <span class="string">'/input'</span>;</span></span><br><span class="line"></span><br><span class="line">// 把本地文件导入到 hive 数据库中</span><br><span class="line"><span class="operator"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/data/login/20130101.csv'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> login <span class="keyword">PARTITION</span> (dt=<span class="string">'20130101'</span>);</span></span><br></pre></td></tr></table></figure>
<h4 id="桶表">桶表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> bucket_table (<span class="keyword">sid</span> <span class="built_in">int</span>, sname <span class="keyword">string</span>, age <span class="built_in">int</span>) clustered <span class="keyword">by</span> (sname) <span class="keyword">into</span> <span class="number">5</span> buckets <span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span>;</span></span><br><span class="line">//创建一个桶表，这个桶表是以sname作为哈希运算，运算后的结果放到5个桶中</span><br></pre></td></tr></table></figure>
<h4 id="视图">视图</h4><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create <span class="keyword">view</span> empinfo</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">select <span class="keyword">e</span>.empno,<span class="keyword">e</span>.ename,<span class="keyword">e</span>.sal,<span class="keyword">e</span>.sal*12 annlsal, <span class="keyword">d</span>.dname</span><br><span class="line">from emp <span class="keyword">e</span>, dept <span class="literal">d</span></span><br><span class="line">where <span class="keyword">e</span>.deptho=<span class="keyword">d</span>.deptho;</span><br><span class="line"><span class="comment">//e.sal*12 annlsal :为e.sal*12起一个别名叫annlsal. 其他操作和普通的表一样。</span></span><br></pre></td></tr></table></figure>
<h4 id="数据导入">数据导入</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//导本机目录下的数据到t3表，并覆盖原来的数据。</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/root/data/'</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> t3;</span></span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/28/flume-config/" itemprop="url">
                  Flume的安装和配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-02-28T18:56:06+08:00" content="2018-02-28">
              2018-02-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="FLume">FLume</h2><h4 id="核心概念">核心概念</h4><p>一个 flume 就是一个 agent。agent 由三部分组成。可以灵活配置</p>
<p><img src="http://flume.apache.org/_images/DevGuide_image00.png" alt="图片"></p>
<h4 id="下载安装">下载安装</h4><p>下载 bin 包，下载就可使用。绿色软件。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.apache.org/dyn</span><span class="regexp">/closer.lua/flume</span><span class="regexp">/1.8.0/apache</span>-flume-<span class="number">1.8</span>.<span class="number">0</span>-bin.tar.gz</span><br></pre></td></tr></table></figure>
<h4 id="配置_JAVA_HOME_环境变量。用_java_1-8_jdk。">配置 JAVA_HOME 环境变量。用 java 1.8 jdk。</h4><h4 id="快速开始_文档">快速开始 <a href="https://cwiki.apache.org//confluence/display/FLUME/Getting+Started" target="_blank" rel="external">文档</a></h4><h4 id="完整文档_点击">完整文档 <a href="http://flume.apache.org/FlumeUserGuide.html#configuring-individual-components" target="_blank" rel="external">点击</a></h4><h4 id="参考">参考</h4><ul>
<li><a href="http://blog.javachen.com/2014/07/22/flume-ng.html" target="_blank" rel="external">实战</a></li>
<li><a href="http://blog.csdn.net/ymh198816/article/details/51540715" target="_blank" rel="external">flume</a></li>
</ul>
<h4 id="Troubleshooting">Troubleshooting</h4><h5 id="使用Flume拉取到HDFS中的文件格式错乱">使用Flume拉取到HDFS中的文件格式错乱</h5><p>这是因为HDFS Sink的配置中，hdfs.writeFormat属性默认为 “Writable” 会将原先的文件的内容序列化成HDFS的格式，应该手动设置成 hdfs.writeFormat=”text”; 并且 hdfs.fileType 默认是 “SequenceFile” 类型的，是将所有 event 拼成一行，应该该手动设置成 hdfs.fileType=”DataStream”，这样就可以是一行一个event，与原文件格式保持一致</p>
<blockquote>
<p>所以啊，要多看文档啊。 有时候英文文档感觉描叙不到位。等我找时间翻译下这个文档。</p>
</blockquote>
<h5 id="后台启动">后台启动</h5><p>可以用 <code>nohup bin/flume-ng agent -n agent -c conf -f conf/flume-conf.properties &gt; /dev/null &amp;</code><br>但是生产环境还是用  <a href="http://supervisord.org/index.html" target="_blank" rel="external">supervisor</a> 来管理吧</p>
<h4 id="实战1_配置本机的_HDFS-">实战1 配置本机的 HDFS.</h4><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 命名</span></span><br><span class="line">tcm.channels = ch-tcm</span><br><span class="line">tcm.sources = src-tcm</span><br><span class="line">tcm.sinks = sink-tcm</span><br><span class="line"><span class="preprocessor"># 配置 agent 的 channels </span></span><br><span class="line">tcm.channels.ch-tcm.type = file</span><br><span class="line">tcm.channels.ch-tcm.checkpointDir = /channels/checkpoint</span><br><span class="line">tcm.channels.ch-tcm.dataDirs = /channels/data</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 配置 agent 的 sources</span></span><br><span class="line">tcm.sources.src-tcm.type = spooldir</span><br><span class="line">tcm.sources.src-tcm.spoolDir = /home/wwwroot/hadoop/flume-<span class="number">1.8</span><span class="number">.0</span>/input/sources</span><br><span class="line"> </span><br><span class="line"><span class="preprocessor"># 配置 sinks</span></span><br><span class="line">tcm.sinks.sink-tcm.type = hdfs</span><br><span class="line">tcm.sinks.sink-tcm.hdfs.path = /hadoop-<span class="number">2.9</span><span class="number">.0</span>/flume/%y-%m-%d</span><br><span class="line"><span class="preprocessor"># 使用本机时间配置</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.useLocalTimeStamp = <span class="literal">true</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.inUsePrefix = .</span><br><span class="line"><span class="preprocessor"># 保留源文件的格式</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.writeFormat = Text</span><br><span class="line"><span class="preprocessor"># 配置成一行一个 event 认是“SequenceFile”类型的，是将所有event拼成一行，应该该手动设置成hdfs.fileType=“DataStream”，这样就可以是一行一个event，</span></span><br><span class="line">与原文件格式保持一致</span><br><span class="line">tcm.sinks.sink-tcm.hdfs.fileType = DataStream</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 通过 channel 链接 sources 和 sinks</span></span><br><span class="line">tcm.sources.src-tcm.channels = ch-tcm</span><br><span class="line">tcm.sinks.sink-tcm.channel = ch-tcm</span><br></pre></td></tr></table></figure>
<h4 id="启动">启动</h4><p><code>bin/flume-ng agent --conf conf/ -f conf/flume.conf  -Dflume.root.logger=INFO,console -n tcm</code></p>
<h4 id="实战2_应用服务器上的数据传到_hadoop_的_namenode_服务器">实战2 应用服务器上的数据传到 hadoop 的 namenode 服务器</h4><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># namenode 配置 conf/<span class="number">33.10</span>.conf</span></span><br><span class="line"><span class="preprocessor"># 命名</span></span><br><span class="line">tcm.channels = ch-tcm</span><br><span class="line">tcm.sources = src-tcm</span><br><span class="line">tcm.sinks = sink-tcm</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 配置 agent 的 channels</span></span><br><span class="line">tcm.channels.ch-tcm.<span class="built_in">type</span> = file</span><br><span class="line">tcm.channels.ch-tcm.checkpointDir = /channels/checkpoint</span><br><span class="line">tcm.channels.ch-tcm.dataDirs = /channels/data</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 配置 agent 的 sources</span></span><br><span class="line">tcm.sources.src-tcm.<span class="built_in">type</span> = avro</span><br><span class="line">tcm.sources.src-tcm.bind = <span class="number">0.0</span>.<span class="number">0.0</span>  </span><br><span class="line">tcm.sources.src-tcm.port = <span class="number">4545</span> </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 配置 sinks</span></span><br><span class="line">tcm.sinks.sink-tcm.<span class="built_in">type</span> = hdfs</span><br><span class="line">tcm.sinks.sink-tcm.hdfs.path = /hadoop-<span class="number">2.9</span>.<span class="number">0</span>/flume/%y-%m-%d</span><br><span class="line"><span class="preprocessor"># 使用本机时间配置</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.useLocalTimeStamp = <span class="literal">true</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.inUsePrefix = .</span><br><span class="line"><span class="preprocessor"># 保留源文件的格式</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.writeFormat = <span class="built_in">Text</span></span><br><span class="line"><span class="preprocessor"># 配置成一行一个 event 认是“SequenceFile”类型的，是将所有event拼成一行，应该该手动设置成hdfs.fileType=“DataStream”，这样就可以是一行一个event，与原文件格式保持一致</span></span><br><span class="line">tcm.sinks.sink-tcm.hdfs.fileType = DataStream</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 通过 channel 链接 sources 和 sinks</span></span><br><span class="line">tcm.sources.src-tcm.channels = ch-tcm</span><br><span class="line">tcm.sinks.sink-tcm.channel = ch-tcm</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 启动命令  bin/flume-ng agent -c conf/ -f conf/<span class="number">33.10</span>.conf -Dflume.root.logger=INFO,console -n tcm</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># ================================================================</span></span><br><span class="line"><span class="preprocessor"># 应用服务器 <span class="number">192.168</span>.<span class="number">33.10</span> conf/f2.conf</span></span><br><span class="line"><span class="preprocessor"># 命名</span></span><br><span class="line"><span class="built_in">agent</span>.sources = src_test10</span><br><span class="line"><span class="built_in">agent</span>.channels = ch_test10</span><br><span class="line"><span class="built_in">agent</span>.sinks =  sink_test10 </span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 配置 channel</span></span><br><span class="line"><span class="built_in">agent</span>.channels.ch_test10.<span class="built_in">type</span> = memory  </span><br><span class="line"><span class="built_in">agent</span>.channels.ch_test10.capacity = <span class="number">10000</span>  </span><br><span class="line">  </span><br><span class="line"><span class="preprocessor"># 配置 source  </span></span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.<span class="built_in">type</span> = spooldir  </span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.spoolDir = /tmp/flume </span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.deserializer.maxLineLength = <span class="number">2048</span>  </span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.interceptors = i2  </span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.interceptors.i2.<span class="built_in">type</span> = host  </span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.interceptors.i2.hostHeader = hostname  </span><br><span class="line"> </span><br><span class="line"><span class="preprocessor"># 配置 sinks  </span></span><br><span class="line"><span class="built_in">agent</span>.sinks.sink_test10.<span class="built_in">type</span> = avro  </span><br><span class="line"><span class="built_in">agent</span>.sinks.sink_test10.channel = ch_test10  </span><br><span class="line"><span class="built_in">agent</span>.sinks.sink_test10.hostname = <span class="number">192.168</span>.<span class="number">33.33</span>  </span><br><span class="line"><span class="built_in">agent</span>.sinks.sink_test10.port = <span class="number">4545</span> </span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># chanel 链接 source 和 sink</span></span><br><span class="line"><span class="built_in">agent</span>.sources.src_test10.channels = ch_test10 </span><br><span class="line"><span class="built_in">agent</span>.sinks.sink_test10.channel = ch_test10 </span><br><span class="line"></span><br><span class="line"><span class="preprocessor">## 启动 bin/flume-ng agent -c conf/ -f conf/f2.conf -Dflume.root.logger=INFO,console -n agent</span></span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/27/Hadoop-install/" itemprop="url">
                  Hadoop实战
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-02-27T18:07:16+08:00" content="2018-02-27">
              2018-02-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Hadoop_集群安装">Hadoop 集群安装</h2><h4 id="准备有2台主机，_登陆到2台（或者多台）服务器_修改_/etc/hosts，内容如下">准备有2台主机， 登陆到2台（或者多台）服务器 修改 /etc/hosts，内容如下</h4><blockquote>
<p>多台服务器，可用 salt 相关命令批管理。</p>
</blockquote>
<ul>
<li>192.168.33.33  namenode</li>
<li>192.168.33.10  datanode</li>
</ul>
<h4 id="创建_Hadoop_用户组">创建 Hadoop 用户组</h4><ul>
<li><code>groupadd hadoop</code></li>
<li><code>useradd -g hadoop hadoop</code></li>
</ul>
<h4 id="配置_namenode_免密登陆_datanode">配置 namenode 免密登陆 datanode</h4><ul>
<li><code>ssh-keygen -t rsa</code> 一路回车，生成公钥</li>
<li>把 <code>.ssh/id_rsa.pub</code> 的内容写入到 datanode 的 <code>~/.ssh/.ssh/authorized_keys</code></li>
<li>修改 datanode 目录权限 <code>chmod 600 .ssh  chmod 700 .ssh/.ssh/authorized_keys</code></li>
</ul>
<blockquote>
<p>如果不成功，就是 <code>/etc/ssh/sshd_config</code> 的某些配置不正确</p>
</blockquote>
<h4 id="在_namenode/datanode_分别安装_java_环境">在 namenode/datanode 分别安装 java 环境</h4><p><code>yum install java java-devel</code></p>
<h4 id="安装_hadoop-2-9-0">安装 hadoop-2.9.0</h4><blockquote>
<p>hadoop 的安装为绿色安装。规划安装目录为 /hadoop-2.9.0</p>
</blockquote>
<ul>
<li>下载 <code>wget https://dist.apache.org/repos/dist/release/hadoop/common/hadoop-2.9.0/hadoop-2.9.0.tar.gz</code></li>
</ul>
<h4 id="修改配置文件_/hadoop-2-9-0/etc/hadoop/">修改配置文件 /hadoop-2.9.0/etc/hadoop/</h4><ul>
<li>slaves</li>
</ul>
<p>添加 datanode， 每行一行，本例中:  datanode</p>
<ul>
<li>core-site.xml</li>
</ul>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&lt;configuration&gt;</span></span><br><span class="line">    <span class="variable">&lt;property&gt;</span></span><br><span class="line">        <span class="variable">&lt;name&gt;</span>fs.<span class="keyword">default</span>FS<span class="variable">&lt;/name&gt;</span></span><br><span class="line">        <span class="variable">&lt;value&gt;</span>hdfs://namenode:<span class="number">9000</span><span class="variable">&lt;/value&gt;</span></span><br><span class="line">    <span class="variable">&lt;/property&gt;</span></span><br><span class="line">    <span class="variable">&lt;property&gt;</span></span><br><span class="line">        <span class="variable">&lt;name&gt;</span>hadoop.tmp.dir<span class="variable">&lt;/name&gt;</span></span><br><span class="line">        <span class="variable">&lt;value&gt;</span>/hadoop-<span class="number">2.9</span>.<span class="number">0</span>/tmp<span class="variable">&lt;/value&gt;</span></span><br><span class="line">    <span class="variable">&lt;/property&gt;</span></span><br><span class="line"><span class="variable">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hdfs-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.namenode.name.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>/hadoop-2.9.0/dfs/name<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>dfs.datanode.data.dir<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>/hadoop-2.9.0/dfs/data<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>mapred-site.xml 首先要 <code>cp etc/hadoop/mapred-site.xml.template  etc/hadoop/mapred-site.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>yarn-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>namenode<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="title">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="title">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hadoop-env.sh</li>
</ul>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export <span class="constant">JAVA_HOME</span>=<span class="regexp">/usr/lib</span><span class="regexp">/jvm/java</span>-openjdk</span><br></pre></td></tr></table></figure>
<h4 id="把_namenode_的_hadoop_软件发送到各个datanode">把 namenode 的 hadoop 软件发送到各个datanode</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -zcf ./hadoop-<span class="number">2.9</span>.<span class="number">0</span><span class="class">.tar</span><span class="class">.gz</span> ./hadoop-<span class="number">2.9</span>.<span class="number">0</span></span><br><span class="line">scp hadoop-<span class="number">2.9</span>.<span class="number">0</span><span class="class">.tar</span><span class="class">.gz</span>  datanode:/</span><br><span class="line">tar -xvf hadoop-<span class="number">2.9</span>.<span class="number">0</span><span class="class">.tar</span><span class="class">.gz</span></span><br></pre></td></tr></table></figure>
<h4 id="设置_JAVA_HOME">设置 JAVA_HOME</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#<span class="operator"><span class="keyword">set</span> <span class="keyword">java</span> environment</span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/lib/jvm/<span class="keyword">java</span>-openjdk</span><br><span class="line"><span class="keyword">export</span> HADOOP_HOME=/home/wwwroot/hadoop/hadoop-<span class="number">2.9</span><span class="number">.0</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">PATH</span>=$&#123;JAVA_HOME&#125;/<span class="keyword">bin</span>:$&#123;HADOOP_HOME&#125;/sbin:$&#123;HADOOP_HOME&#125;/<span class="keyword">bin</span>:$<span class="keyword">PATH</span></span></span><br></pre></td></tr></table></figure>
<h4 id="格式化文件系统">格式化文件系统</h4><p><code>hdfs namenode -format</code></p>
<h4 id="启动">启动</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">start-dfs<span class="class">.sh</span></span><br><span class="line">start-yarn<span class="class">.sh</span></span><br><span class="line">mr-jobhistory-daemon<span class="class">.sh</span> start historyserver</span><br></pre></td></tr></table></figure>
<h4 id="成功后通过_jps_命令可以在_namenode_看到">成功后通过 jps 命令可以在 namenode 看到</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NameNode、</span><br><span class="line">ResourceManager、</span><br><span class="line">SecondrryNameNode、</span><br><span class="line">JobHistoryServer</span><br></pre></td></tr></table></figure>
<p>在 datanode 通过 jps 可以看到</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">DataNode</span></span><br><span class="line">NodeManager</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="http://www.powerxing.com/install-hadoop/" target="_blank" rel="external">http://www.powerxing.com/install-hadoop/</a></li>
<li><a href="http://www.powerxing.com/install-hadoop-cluster/" target="_blank" rel="external">http://www.powerxing.com/install-hadoop-cluster/</a></li>
</ul>
<h3 id="QA">QA</h3><h5 id="开启分布式后，运行_job_会感觉慢？">开启分布式后，运行 job 会感觉慢？</h5><p>因为自己的机器内存不足，所以开发测试情况下，建议用单机模式。</p>
<h5 id="如何让_system-out-println()_打印到控制台？">如何让 system.out.println() 打印到控制台？</h5><p>默认是可以打印出的，如果没有打印出，应该是之前配置过 mapred-site.xml。 把里面的配置删掉或者注释掉，就可以打印到控制台了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/01/config_Java_home/" itemprop="url">
                  centos 配置 JAVA_HOME
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2018-01-01T20:56:06+08:00" content="2018-01-01">
              2018-01-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="centos_配置_JAVA_HOME">centos 配置 JAVA_HOME</h2><h3 id="安装">安装</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="operator"><span class="keyword">install</span> <span class="keyword">java</span> <span class="keyword">java</span>-devel</span></span><br></pre></td></tr></table></figure>
<p>默认安装在 <code>/usr/lib/jvm/java-openjdk</code></p>
<p>通过 <code>ll</code> 命令可看到 java-openjdk 是个软连接<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@namenode</span> jvm]<span class="comment"># ll /usr/lib/jvm/java-openjdk</span></span><br><span class="line">lrwxrwxrwx <span class="number">1</span> root root <span class="number">34</span> <span class="constant">Feb</span> <span class="number">20</span> <span class="number">14</span>:<span class="number">28</span> /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">java</span>-<span class="title">openjdk</span> -&gt; /<span class="title">etc</span>/<span class="title">alternatives</span>/<span class="title">java_sdk_openjdk</span></span></span><br></pre></td></tr></table></figure></p>
<p>再通过 <code>ll /etc/alternatives/java_sdk_openjdk</code> 就可以到实际的目录地址</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@namenode jvm]<span class="preprocessor"># ll /etc/alternatives/java_sdk_openjdk</span></span><br><span class="line">lrwxrwxrwx <span class="number">1</span> root root <span class="number">60</span> Feb <span class="number">20</span> <span class="number">14</span>:<span class="number">28</span> /etc/alternatives/java_sdk_openjdk -&gt; /usr/lib/jvm/java-<span class="number">1.8</span><span class="number">.0</span>-openjdk-<span class="number">1.8</span><span class="number">.0</span><span class="number">.161</span>-<span class="number">0.</span>b14.el7_4.x86_64</span><br></pre></td></tr></table></figure>
<h3 id="配置_JAVA_HOME">配置 JAVA_HOME</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line">#<span class="operator"><span class="keyword">set</span> <span class="keyword">java</span> environment</span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/lib/jvm/<span class="keyword">java</span>-openjdk</span></span><br></pre></td></tr></table></figure>
<h3 id="问题：">问题：</h3><ul>
<li>当遇到 JAVA_HOME 版本不对？</li>
</ul>
<p>这就需要更改 <code>/etc/alternatives/java_sdk_openjdk</code> 实际的软连接地址。</p>
<p>或者直接在 <code>~/.bashrc</code> 里直接修改为</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#set java environment</span></span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">1.8</span><span class="number">.0</span>-openjdk-<span class="number">1.8</span><span class="number">.0</span><span class="number">.161</span>-<span class="number">0.</span>b14.el7_4.x86_64</span><br></pre></td></tr></table></figure>
<p>但是要注意查看 <code>java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64</code> 目录下是不是 <code>jre</code> 目录，如果有需要如下配置才能生效：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#set java environment</span></span><br><span class="line"><span class="keyword">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="number">1.8</span><span class="number">.0</span>-openjdk-<span class="number">1.8</span><span class="number">.0</span><span class="number">.161</span>-<span class="number">0.</span>b14.el7_4.x86_64/jre</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/01/learn-java/" itemprop="url">
                  学习大数据要掌握的 java 知识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-12-01T18:21:16+08:00" content="2017-12-01">
              2017-12-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="学习第一阶段目标">学习第一阶段目标</h2><h3 id="目标">目标</h3><p> Flume + Hadoop（Java） + Hive + Sqoop 的离线分析系统</p>
<h3 id="学习顺序">学习顺序</h3><h4 id="了解整体架构">了解整体架构</h4><ul>
<li>离线分析系统的整体架构 </li>
<li>每个部分数据传输流程</li>
</ul>
<h5 id="参考文章">参考文章</h5><ul>
<li><a href="http://blog.csdn.net/ymh198816" target="_blank" rel="external">Flume+Spark+Hive+Spark SQL离线分析系统</a></li>
<li><a href="http://blog.csdn.net/ymh198816/article/details/51998085" target="_blank" rel="external">Flume+Kafka+Storm+Redis实时分析系统基本架构</a></li>
<li><a href="http://blog.csdn.net/ymh198816/article/details/51540715" target="_blank" rel="external">Flume+Hadoop+Hive的离线分析系统基本架</a></li>
<li><a href="http://tech.youzan.com/you-zan-tong-ri-zhi-ping-tai-chu-tan/" target="_blank" rel="external">有赞统一日志平台初探</a></li>
</ul>
<h4 id="Java_基本语法">Java 基本语法</h4><ul>
<li>基本数据类型 </li>
<li>面向对象 <a href="https://www.imooc.com/search/?words=java入门第一季" target="_blank" rel="external">资料</a></li>
</ul>
<h5 id="验收方式">验收方式</h5><ul>
<li>能看懂 Hadoop 文档自带的 WordCount 应用的代码。</li>
</ul>
<h4 id="Hadoop">Hadoop</h4><ul>
<li>HDFS 分布式文件系统</li>
<li>配置单点，集群 熟练理解文档自带的 WordCount 应用。<a href="https://hadoop.apache.org/docs/r1.0.4/cn/quickstart.html#Local" target="_blank" rel="external">1.x中文</a> ， <a href="http://hadoop.apache.org/docs/r2.9.0/hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html" target="_blank" rel="external">2.x</a></li>
<li>理解示例 WordCount 使用到的 Hadoop 接口。学会查看 <a href="http://hadoop.apache.org/docs/r2.9.0/api/allclasses-noframe.html" target="_blank" rel="external">Hadoop类库</a></li>
</ul>
<h5 id="验收方式-1">验收方式</h5><ul>
<li>把淘车猫的 access_log 上传到 Hadoop 的文件系统中。</li>
<li>能使用 Hadoop 的文件系统常用命令。文件的创建，移动等等</li>
</ul>
<h4 id="Java_接口函数">Java 接口函数</h4><ul>
<li>集合框架 <a href="https://www.imooc.com/search/?words=java入门第三季" target="_blank" rel="external">资料</a></li>
<li>处理各种字符串的对象函数 找一些小项目源码多练习</li>
<li>ArrayList, HashSet, Map 等数据结构</li>
</ul>
<h5 id="验收方式-2">验收方式</h5><ul>
<li>能看到 Hadoop 文档自带应用 WordCount 2.0 版本</li>
<li>能使用集合框架写出学习资料里最后的 扑克 应用。</li>
</ul>
<h4 id="Hive">Hive</h4><ul>
<li>HiveSql 学习</li>
</ul>
<h5 id="验收方式-3">验收方式</h5><ul>
<li>可以通过文本数据创建 HiveSql 表，并可以做排序等操作</li>
<li>能实现 <a href="http://blog.csdn.net/ymh198816/article/details/51540715" target="_blank" rel="external">这里</a> 的例子</li>
</ul>
<h4 id="Sqoop">Sqoop</h4><ul>
<li>具体学习的内容还没看</li>
</ul>
<h5 id="验收方式-4">验收方式</h5><ul>
<li>能把 Hive 数据导入进 Mysql。</li>
</ul>
<h4 id="Flume">Flume</h4><ul>
<li>Flume 配置</li>
</ul>
<h5 id="验收方式-5">验收方式</h5><ul>
<li>可以把 access.log 文件，导入进 Hadoop 文件系统。</li>
</ul>
<h4 id="综合_Demo，统计_Uv，Pv_（1周）">综合 Demo，统计 Uv，Pv （1周）</h4><ul>
<li>统计分析淘车猫的 access_log</li>
</ul>
<h2 id="学习第二阶段目标">学习第二阶段目标</h2><h3 id="to_be_continue_…">to be continue …</h3>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/14/emao-container_1/" itemprop="url">
                  emao-container_1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-08-14T16:14:46+08:00" content="2017-08-14">
              2017-08-14
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>16年的时候整理过一篇IOC的实现原理，在进一步之前可先 <a href="./container.md">查看</a><br>然后结合laravel再来看IOC的实现，便会有一种 <code>原来是这样</code> 的感受。从而也会对一直不接触的设计模式有根清晰的认识。</p>
</blockquote>
<p>先来看几个名词</p>
<ul>
<li><a href="#DI">依赖注入</a> （dependency injection）</li>
<li><a href="#IOC">控制反转</a> （Inversion Of Control, IOC）</li>
</ul>
<p><a name="DI"></a></p>
<h3 id="依赖注入">依赖注入</h3><p>这是一个很花哨的名词，如很多设计模式一样，但不了解具体实现的时候就会觉得雨里雾里，不知所云。</p>
<p>先来看一段简单的代码，也是很「经典」的代码</p>
<pre><code>class UserController
{
    publc function getUserInfo(<span class="variable">$id</span>)
    {
           <span class="variable">$model</span> = new UserDao;

           return <span class="variable">$model-</span>&gt;where(<span class="string">'id'</span>, <span class="variable">$id</span>)-&gt;first();
    }
}
</code></pre><p>也许你看出来了，所谓「经典」并不是因为代码有奇妙之处，而是，这样的代码在很多「工程师」的代码里，随处可见。</p>
<p>这样的代码一个很明显的问题便是，「高级代码」依赖「低级代码」，「低级代码」如果出错，哪「高级代码」就完全用不了。</p>
<blockquote>
<p>{tip} 「高级代码」 业务逻辑代码实现，也就是最终呈现给用户的代码。 「低级代码」 数据库操作，文件操作，网络操作等一切为业务服务的代码。 </p>
</blockquote>
<p>来看一段改进</p>
<pre><code>class UserController
{
    protected <span class="variable">$user</span>;

    publc function getUserInfo(User <span class="variable">$user</span>, <span class="variable">$id</span>)
    {         
           return <span class="variable">$user-</span>&gt;where(<span class="string">'id'</span>, <span class="variable">$id</span>)-&gt;first();
    }
}
</code></pre><p>修改以后的业务代码，不需要知道数据从何而来，只需要知道从一个 <code>User</code> 对象能获取到所需要的数据。</p>
<p>这样的方式便叫「依赖注入」，「我」依赖你，但并不是离了「你」就不能活。 </p>
<p><a name="IOC"></a></p>
<h3 id="控制反转">控制反转</h3><p>控制反转是依赖注入的一种改进，在上面的代码中，「高级代码」 想要获取到「低级代码」数据，必须手动传入「User」，这样当「User」作出修改，哪「高级代码」依赖的部分也要做出修改。</p>
<p>利用「控制反转」来实现</p>
<pre><code>class UserController
{
    protected <span class="variable">$user</span>;

    publc function getUserInfo(UserInterface <span class="variable">$user</span>, <span class="variable">$id</span>)
    {         
           return <span class="variable">$user-</span>&gt;where(<span class="string">'id'</span>, <span class="variable">$id</span>)-&gt;first();
    }
}
</code></pre><p>这里注入的是一个「接口」，「高级代码」不依赖具体的实现，而依赖的是实现的接口。这样无论「低级代码」作出怎样的修改，「高级代码」都不需要做任何修改。</p>
<blockquote>
<p>这就是「面向对象」常说的：要面向接口编程，而不是面向实现。</p>
</blockquote>
<h3 id="Laravel容器实现">Laravel容器实现</h3><p>容器的终极目标就是解决「依赖」。让「低级代码」的实现，不会出现在「高级代码」的逻辑中。</p>
<p>通过Laravel的「Route」模块，来分析容器的实现。看 <code>routes/web.php</code> 的内容</p>
<blockquote>
<p>以前，每当学习一个框架的时候，首先看的是控制器，因为比较容易看到效果。</p>
</blockquote>
<pre><code>Route::<span class="keyword">get</span>('/',funtion(){
     <span class="function"><span class="keyword">return</span> <span class="title">view</span><span class="params">(<span class="string">'welcome'</span>)</span></span>;
})
</code></pre><p>初学者往往会以为这里就是框架的入口—因为我们写的业务代码确实是从这里开始的，从而导致了很多人认为请求直接就到了这里。其实不然。</p>
<p>既然 <code>web.php</code> 里可以使用 <code>Route::method</code> ，通过 <a href="./container.md">这篇文章</a> 可以知道，既然这里可以使用，必然有地方进行了「绑定」。</p>
<p>有一个现成的「轮子」，<code>Illuminate\Container</code> （容器） Laravel框架的核心程序便是继承了这个「轮子」，然后把「其他模块」通过「绑定」的方式，组合进了框架。所以 <code>Laravel</code> 的核心代码很少。其中「路由」，「请求」，「响应」等等各个模块都是通过「绑定」的方式组合到一起实现强大的功能。</p>
<p>在进一步之前，确保你已经看懂了Laravel的文档，<a href="https://d.laravel-china.org/docs/5.5/lifecycle" target="_blank" rel="external">请求的生命周期</a>，很多时候最好的学习资料是框架本身提供的文档。</p>
<p>Laravel 通过 <code>Illuminate\Container</code> 提供的 <code>bind</code> <code>instance</code> <code>singleton</code>     等等方式进行「注入」到容器里，再通过<code>make</code> 获取到注入的「实例」「匿名函数」「接口实现」等。</p>
<blockquote>
<p>本来打算写每个函数的用法，然后发现，无论怎么写，都没有官方文档总结的到位。遂放弃，所以建议多读几遍官方文档吧。</p>
</blockquote>
<p>接着上面的 <code>Route</code> 继续看，通过查看 <code>Illuminate\FoundationApplication</code> 可以看到，Laravel通过「Container」注入了路由的「服务提供者」，并把「Container」传给了「服务提供者」</p>
<pre><code><span class="variable">$this-</span>&gt;register(new RoutingServiceProvider(<span class="variable">$this</span>));
</code></pre><p>而后由 <code>RoutingServiceProvider</code> 自己注册实现和所需要的依赖。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">RoutingServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span>
</span>{
    <span class="comment">/**
     * Register the service provider.
     *
     * <span class="doctag">@return</span> void
     */</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span>
    </span>{
        <span class="variable">$this</span>-&gt;registerRouter();

        <span class="variable">$this</span>-&gt;registerUrlGenerator();

        <span class="variable">$this</span>-&gt;registerRedirector();

        <span class="variable">$this</span>-&gt;registerPsrRequest();

        <span class="variable">$this</span>-&gt;registerPsrResponse();

        <span class="variable">$this</span>-&gt;registerResponseFactory();
    }
</code></pre><p>这时候，我们便可以通过 <code>$app[&#39;route&#39;]</code> 或者 <code>$app-&gt;route</code> 来获取到路由的实现，这会执行「容器」的 <code>make</code> 方法。获取到之前注册的内容。</p>
<p>而在<code>web.php</code>里没有这样写，这就涉及到另一个概念 <code>Facade</code>。</p>
<p>看到配置文件 <code>bootstrap/app.php</code></p>
<pre><code>aliases' =&gt; [
    <span class="symbol">'Route'</span> =&gt; <span class="type">Illuminate</span>\<span class="type">Support</span>\<span class="type">Facades</span>\<span class="type">Route</span>::<span class="keyword">class</span>
]
</code></pre><p>当使用 <code>Route</code> 的实际调用的是 <code>Illuminate\Support\Facades\Route::class</code> , <code>Route::method</code> </p>
<p>执行的就是 <code>Illuminate\Support\Facades::__callStatic</code></p>
<pre><code>public static <span class="keyword">function</span> __callStatic(<span class="variable">$method</span>, <span class="variable">$args</span>)
{
    <span class="variable">$instance</span> = static::getFacadeRoot();

    if (! <span class="variable">$instance</span>) {
        throw new RuntimeException(<span class="string">'A facade root has not been set.'</span>);
    }

    return <span class="variable">$instance-</span>&gt;<span class="variable">$method</span>(...<span class="variable">$args</span>);
}
</code></pre><p>其中 </p>
<pre><code><span class="variable">$instance</span> = static::getFacadeRoot();
</code></pre><p>最终调用</p>
<pre><code>protected static <span class="keyword">function</span> resolveFacadeInstance(<span class="variable">$name</span>)
{
    if (is_object(<span class="variable">$name</span>)) {
        return <span class="variable">$name</span>;
    }

    if (isset(static::<span class="variable">$resolvedInstance</span>[<span class="variable">$name</span>])) {
        return static::<span class="variable">$resolvedInstance</span>[<span class="variable">$name</span>];
    }

    return static::<span class="variable">$resolvedInstance</span>[<span class="variable">$name</span>] = static::<span class="variable">$app</span>[<span class="variable">$name</span>];
}
</code></pre><p>可以看到，其实就是调用了 <code>$app[name]</code> ;</p>
<p>到此，通过容器的分析，便可以了解laravel的核心概念了。    </p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/03/2017-diary/" itemprop="url">
                  2017_diary
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2017-01-03T18:23:13+08:00" content="2017-01-03">
              2017-01-03
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一年过去了，竟然没有什么一件事情可以称为记忆深刻。感觉记忆好模糊的一年啊。</p>
<p>从6月份离开联想到现在，这半年没做过能记得名字的项目。</p>
<p>没有实质性的改变，想写个年终总结都不知道从何写起。一年过了，跟没过似的。只蹉跎了岁月，却毫无长进。</p>
<p>但是。该写个规划啊。毕竟2017第一天上班日。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/07/nfs/" itemprop="url">
                  nfs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-12-07T11:21:29+08:00" content="2016-12-07">
              2016-12-07
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>服务器启动</p>
<p>service rpcbind restart<br>service nfs restart</p>
<p>服务端查看  showmount -e  //查看自己共享的</p>
<p>showmount -a //查看链接的客户端</p>
<p>客户端查看  showmount -e 192.168.33.10<br>客户端挂载  mount -t nfs 192.168.33.10:/data/www/ /data/www/packages-emao<br>客户端挂载时候遇到<br>mount clntudp_create: RPC: Program not registered<br>执行下  rpc.mountd 就可以了</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars1.githubusercontent.com/u/3827764?v=3&s=460" alt="skylee" itemprop="image"/>
          <p class="site-author-name" itemprop="name">skylee</p>
        </div>
        <p class="site-description motion-element" itemprop="description">行走于浩瀚</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">skylee</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/ven/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/ven/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/ven/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/ven/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/ven/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/ven/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
